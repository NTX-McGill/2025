# Data collection platform

The following will guide you on how to run the data collection platform or CLI.

## Dependencies:

Prerequisites:

- Clone 2025 folder to vscode or IDE of choice
- Conda installed on your system (https://docs.anaconda.com/free/miniconda/)
- Pandas installed (within conda) 'pip install pandas'
- The OpenBCI Gui installed (https://openbci.com/downloads)
- Pylsl pip installed
- Pygame pip installed

If on linux, do `conda env create -f environment.yml`, which will create a conda environment called `neurotech` with all the necessary dependencies installed.
If on MacOS: do `conda create --name NTech python=3.11`


## OpenBCI GUI setup

The goal of this section is to funnel the data collected by a BCI board into 8-channel EEG LSL output stream that can be processed by the CLI and other python files. Note that if you just want to mock an 8-channel EEG LSL output stream, you can use the command `liesl mock --type EEG` to do so instead of using a synthetic OpenBCI Board with the OpenBCI GUI.

To set up the OpenBCI GUI with a physical or synthetic board, first start the OpenBCI GUI. Then:

1. Set up an 8-channel synthetic board for testing. Skip this step if you are using a physical board, follow the instructions on how to setup that board instead:
   ![image](./images/bci-step-1.png)

2. Open the networking tab (under the drop down time series menu):
   ![image](./images/bci-step-2.jpg)

3. Set the output protocol to LSL:
   ![image](./images/bci-step-3.png)

4. Set the data type to TimeSeriesRaw for all 3 streams:
   ![image](./images/bci-step-4.png)

## Synthetic Testing 

First, make sure to activate the correct conda environment with `conda activate neurotech`

Then, while the LSL Stream from the OpenBCI is started, run `python cli.py` (from the data_collection_platform folder).
Then, connect to the OpenBCI stream and marker stream with option (4). In the `logs/test.log` file in your IDE you should see the following:

```
2024-02-16 20:39:51,151 csv_data_recorder INFO Looking for an EEG stream...
2024-02-16 20:39:55,752 csv_data_recorder INFO Connected to stream: obci_eeg1, Stream channel_count: 8
2024-02-16 20:39:55,752 csv_data_recorder INFO Looking for a marker stream...
2024-02-16 20:39:55,753 csv_data_recorder INFO Found 1 streams
2024-02-16 20:39:55,753 csv_data_recorder INFO Connected to stream: Neurotech markers
```

Then you should be able to start and stop recording with options (2) and (3) respectively.
Use option (1) to send one of the four cross, beep, left, and right markers.

If a connection to the LSL EEG stream is lost, reconnecting the stream should automatically allow data collection to continue.

# Live Testing: 
First, make sure to activate the correct conda environment with `conda activate neurotech`
Then, while the LSL Stream from the OpenBCI is started, run `python recorder.py` (from the data_collection_platform folder). Enter your file name when prompted. Then, connect to the OpenBCI stream and marker stream with option (4). In the `logs/test.log` file in your IDE you should see the following: ////

## The steps below are the same for synthetic and live data collection: 

# Running the data collection platform

Then, while the LSL and OpenBCI Streams have started, run `python main.py` (from the data_collection_platform folder). You should be greeted by the data collection dashboard: 

Hit space to start the timer. After 5 seconds of rest the dahsboard will alternate through visual prompts for 10 seconds with a 5 second rest between each command. This cycle will run for apx 4 minutes before ending on rest.  

A collected_data directory will be automatically created after the first time you run the data collection platform; raw data is stored in .csv files.

# Safely ending data collection
Start by hitting escape in the acessory window generated by running python recorder.py. Then stop both data and lsl streams in the OpenBCI interface. Finally, ^C to stop the main.py from running. (this will be streamlined soon
